#!/usr/bin/env ruby
# encoding: utf-8

##
# –§—É–Ω–∫—Ü—ñ—è curry3 "–∫–∞—Ä—Ä—É—î" –±—É–¥—å-—è–∫—É –ª—è–º–±–¥—É –∞–±–æ proc, —â–æ –æ—á—ñ–∫—É—î 3 –∞—Ä–≥—É–º–µ–Ω—Ç–∏.
# –í–æ–Ω–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤—É –ª—è–º–±–¥—É, —è–∫–∞ –Ω–∞–∫–æ–ø–∏—á—É—î –∞—Ä–≥—É–º–µ–Ω—Ç–∏, –¥–æ–∫–∏ –Ω–µ –æ—Ç—Ä–∏–º–∞—î –≤—Å—ñ 3.
#
# @param proc_or_lambda [Proc] –õ—è–º–±–¥–∞ –∞–±–æ proc –∑ arity 3.
# @return [Proc] –ù–æ–≤–∞ –ª—è–º–±–¥–∞, —â–æ –ø—ñ–¥—Ç—Ä–∏–º—É—î —á–∞—Å—Ç–∫–æ–≤–µ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è.
#
def curry3(proc_or_lambda)
  # –í–∏–∑–Ω–∞—á–∞—î–º–æ, —Å–∫—ñ–ª—å–∫–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ (–∑–≥—ñ–¥–Ω–æ –∑ –Ω–∞–∑–≤–æ—é)
  required_arity = 3

  # 'collector' - —Ü–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞ –ª—è–º–±–¥–∞, —â–æ —Å—Ç–≤–æ—Ä—é—î –∑–∞–º–∏–∫–∞–Ω–Ω—è.
  # –í–æ–Ω–∞ –ø—Ä–∏–π–º–∞—î 'collected_args' - —Å–ø–∏—Å–æ–∫ –≤–∂–µ –∑—ñ–±—Ä–∞–Ω–∏—Ö –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤.
  collector = ->(collected_args) do

    # ...—ñ –≤–æ–Ω–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –ù–û–í–£ –ª—è–º–±–¥—É, —è–∫—É –º–∏ –±—É–¥–µ–º–æ –≤–∏–∫–ª–∏–∫–∞—Ç–∏
    ->(*new_args) do
      # 1. –ó–±–∏—Ä–∞—î–º–æ –≤—Å—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ —Ä–∞–∑–æ–º
      all_args = collected_args + new_args

      # 2. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —Å–∫—ñ–ª—å–∫–∏ –º–∏ –∑—ñ–±—Ä–∞–ª–∏
      case all_args.length
      when 0...required_arity
        # 3a. –©–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ. –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–æ–≤–∏–π 'collector',
        #     —è–∫–∏–π "–ø–∞–º'—è—Ç–∞—î" –≤—Å—ñ –∑—ñ–±—Ä–∞–Ω—ñ 'all_args'.
        collector.call(all_args)
      when required_arity
        # 3b. –†—ñ–≤–Ω–æ 3. –ß–∞—Å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—É –ª—è–º–±–¥—É.
        proc_or_lambda.call(*all_args)
      else
        # 3c. –ë—ñ–ª—å—à–µ 3. –¶–µ –ø–æ–º–∏–ª–∫–∞ –∑–≥—ñ–¥–Ω–æ –∑ –≤–∏–º–æ–≥–∞–º–∏.
        raise ArgumentError,
              "wrong number of arguments (given #{all_args.length}, expected #{required_arity})"
      end
    end
  end

  # 4. –ó–∞–ø—É—Å–∫–∞—î–º–æ –ø—Ä–æ—Ü–µ—Å: –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –ø–µ—Ä—à–∏–π 'collector'
  #    –∑ –ø–æ—Ä–æ–∂–Ω—ñ–º —Å–ø–∏—Å–∫–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤.
  collector.call([])
end


# ===================================================================
#                    üöÄ –î–ï–ú–û–ù–°–¢–†–ê–¶–Ü–Ø
# ===================================================================
puts "===== ü§ñ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è curry3 ====="

# 1. –°—Ç–≤–æ—Ä—é—î–º–æ –±–∞–∑–æ–≤—É –ª—è–º–±–¥—É
sum3 = ->(a, b, c) { a + b + c }

puts "–û—Ä–∏–≥—ñ–Ω–∞–ª: sum3.call(1, 2, 3) => #{sum3.call(1, 2, 3)}"
puts "------------------------------------"

# 2. –°—Ç–≤–æ—Ä—é—î–º–æ "–∫–∞—Ä—Ä–æ–≤–∞–Ω—É" –≤–µ—Ä—Å—ñ—é
cur = curry3(sum3)

# 3. –î–µ–º–æ–Ω—Å—Ç—Ä—É—î–º–æ —Ä—ñ–∑–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –≤–∏–∫–ª–∏–∫—É

# cur.call(1).call(2).call(3)
begin
  puts "cur.call(1).call(2).call(3) => #{cur.call(1).call(2).call(3)}"
rescue => e
  puts "–ü–û–ú–ò–õ–ö–ê: #{e.message}"
end

# cur.call(1, 2).call(3)
begin
  puts "cur.call(1, 2).call(3)    => #{cur.call(1, 2).call(3)}"
rescue => e
  puts "–ü–û–ú–ò–õ–ö–ê: #{e.message}"
end

# cur.call(1).call(2, 3)
begin
  puts "cur.call(1).call(2, 3)    => #{cur.call(1).call(2, 3)}"
rescue => e
  puts "–ü–û–ú–ò–õ–ö–ê: #{e.message}"
end

# cur.call(1, 2, 3)
begin
  puts "cur.call(1, 2, 3)        => #{cur.call(1, 2, 3)}"
rescue => e
  puts "–ü–û–ú–ò–õ–ö–ê: #{e.message}"
end

# cur.call()
begin
  # –¶–µ–π –≤–∏–∫–ª–∏–∫ –ø–æ–≤–µ—Ä–Ω–µ –Ω–æ–≤—É –ª—è–º–±–¥—É, –∞ –Ω–µ –≤–∏–∫–æ–Ω–∞—î —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫
  puts "cur.call().class            => #{cur.call().class}"
  # –ú–∏ –º–æ–∂–µ–º–æ –Ω–∞–≤—ñ—Ç—å –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —ó—ó –¥–∞–ª—ñ
  puts "cur.call().call(1,2,3)    => #{cur.call().call(1,2,3)}"
rescue => e
  puts "–ü–û–ú–ò–õ–ö–ê: #{e.message}"
end

puts "------------------------------------"
puts "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∑ —ñ–Ω—à–æ—é –ª—è–º–±–¥–æ—é (String):"

f = ->(a, b, c) { "#{a}-#{b}-#{c}" }
cF = curry3(f)
puts "cF.call('A').call('B', 'C')   => #{cF.call('A').call('B', 'C')}"

puts "------------------------------------"
puts "–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –ø–æ–º–∏–ª–∫–∏ (–∑–∞–±–∞–≥–∞—Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤):"

# cur.call(1, 2, 3, 4)
begin
  puts "cur.call(1, 2, 3, 4)      => #{cur.call(1, 2, 3, 4)}"
rescue ArgumentError => e
  puts "cur.call(1, 2, 3, 4)      => –°–ø—ñ–π–º–∞–Ω–æ –æ—á—ñ–∫—É–≤–∞–Ω—É –ø–æ–º–∏–ª–∫—É: #{e.message}"
end

puts "===== ‚úÖ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ====="